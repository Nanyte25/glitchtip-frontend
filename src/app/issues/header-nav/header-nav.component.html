<section id="project-picker">
  <mat-accordion displayMode="flat" [hideToggle]="false">
    <mat-expansion-panel
      #expansionPanel
      class="mat-elevation-z1"
      (opened)="focusPanel()"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          {{ appliedProjectsString$ | async }}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-form-field>
        <input
          #filterInput
          type="text"
          placeholder="Filter projects"
          aria-label="Filter projects"
          matInput
          [formControl]="filterProjectInput"
        />
      </mat-form-field>

      <mat-list>
        <mat-list-item
          class="list-item"
          *ngFor="let project of filteredProjects$ | async"
        >
          <button
            id="picker-button-{{ project.id }}"
            class="picker-button mat-body-1"
            (click)="selectProjectAndClose(project.id)"
          >
            {{ project.name }}
          </button>
          <mat-checkbox
            (change)="toggleProject(project.id)"
            [checked]="isSelected(project.id)"
          >
          </mat-checkbox>
        </mat-list-item>
      </mat-list>

      <div class="button-group">
        <button
          *ngIf="someProjectsAreSelected$ | async"
          mat-stroked-button
          (click)="navigate(null); expansionPanel.close()"
        >
          View All
        </button>
        <button mat-flat-button (click)="closePanel()" color="primary">
          <ng-container
            *ngIf="(selectedAndAppliedIdsAreEqual$ | async) === false"
          >
            Apply &
          </ng-container>
          Close
        </button>
      </div>
    </mat-expansion-panel>
    <button
      mat-button
      class="reset-button"
      *ngIf="(appliedProjectIds$ | async)?.length > 0"
      (click)="navigate(null)"
    >
      <mat-icon>close</mat-icon>
    </button>
  </mat-accordion>
</section>
