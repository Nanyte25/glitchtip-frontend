<section *ngIf="event$ | async as event" class="mat-typography">
  <section class="header">
    <div>
      <h2>Event</h2>
      <p>
        <a>{{ event?.eventID }}</a>
      </p>
      <p>
        <span *ngIf="event?.dateCreated" class="space">{{
          event?.dateCreated
        }}</span
        ><span>
          <!-- Link to JSON and (size) -->
          <a>JSON (31.7 KB)</a>
        </span>
      </p>
    </div>
    <div>
      <a
        mat-button
        [routerLink]="previousEventUrl$ | async"
        [disabled]="(previousEvent$ | async) === false"
        ><mat-icon>keyboard_arrow_left</mat-icon> Older</a
      >
      <a
        mat-button
        [routerLink]="nextEventUrl$ | async"
        [disabled]="(nextEvent$ | async) === false"
        >Newer <mat-icon>keyboard_arrow_right</mat-icon></a
      >
    </div>
  </section>

  <mat-divider></mat-divider>

  <section
    *ngIf="event?.user || event?.contexts?.browser"
    class="location"
  >
    <div class="wrapper">
      <mat-icon> my_location</mat-icon>
      <div class="mat-body-strong spacer">{{ event?.user.ip_address }}</div>
    </div>
    <div class="wrapper">
      <mat-icon>laptop</mat-icon>
      <div class="spacer">
        <p class="mat-body-strong">{{ event?.contexts.browser.name }}</p>
        <p class="mat-small mat-caption">
          <span class="bold">Version:</span
          ><span class="spacer-small">{{
            event?.contexts.browser.version
          }}</span>
        </p>
      </div>
    </div>
    <div class="wrapper">
      <mat-icon>devices</mat-icon>
      <div class="spacer">
        <p class="mat-body-strong">{{ event?.contexts.os.name }}</p>
        <p class="mat-small mat-caption">
          <span class="bold">Version:</span
          ><span class="spacer-small">{{ event?.contexts.os.version }}</span>
        </p>
      </div>
    </div>
  </section>

  <mat-divider *ngIf="event?.user || event?.contexts?.browser"></mat-divider>

  <section class="tags">
    <h3>Tags</h3>
    <mat-chip-list class="wrapper">
      <mat-chip *ngFor="let tag of event?.tags"
        ><span>{{ tag.key }}:</span>
        <a routerLink="." class="spacer">{{ tag.value }}</a></mat-chip
      >
    </mat-chip-list>
  </section>

  <mat-divider></mat-divider>

  <section *ngIf="event?.entries.length > 0" class="exception">
    <div class="header-wrapper">
      <div class="text-wrapper">
        <h3>Exception</h3>
        <p *ngIf="group.value === 'full'" class="spacer">
          (<a (click)="getFlippedFrames()">most recent call first</a>)
        </p>
      </div>
      <mat-button-toggle-group #group="matButtonToggleGroup">
        <mat-button-toggle checked value="full" aria-label="full data">
          Full
        </mat-button-toggle>
        <mat-button-toggle value="raw" aria-label="raw data">
          Raw
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
    <div class="full" *ngIf="group.value === 'full'">
      <ng-container
        *ngFor="let entry of event?.entries"
        [ngSwitch]="entry.type"
      >
        <div *ngSwitchCase="'exception'">
          <div *ngFor="let value of entry.data.values">
            <h2>{{ value.type }}</h2>
            <p>{{ value.value }}</p>
            <mat-chip-list>
              <mat-chip disabled
                >mechanism: {{ value.mechanism.type }}</mat-chip
              >
              <mat-chip color="accent" selected disabled
                >handled: {{ value.mechanism.handled ? "yes" : "no" }}</mat-chip
              >
              <mat-chip *ngIf="value.mechanism.data" disabled
                >function: {{ value.mechanism.data.function }}</mat-chip
              >
            </mat-chip-list>

            <mat-accordion>
              <mat-expansion-panel
                *ngFor="let frame of value.stacktrace.frames"
              >
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{ frame.filename }}
                    <a
                      mat-icon-button
                      color="primary"
                      target="_blank"
                      [href]="frame.absPath"
                    >
                      <mat-icon>open_in_new</mat-icon>
                    </a>
                  </mat-panel-title>
                  <mat-panel-description>
                    in {{ frame.function }} at line {{ frame.lineNo }}:{{
                      frame.colNo
                    }}
                  </mat-panel-description>
                </mat-expansion-panel-header>
                <p *ngFor="let context of frame.context">
                  {{ context[0] }}. {{ context[1] }}
                </p>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
        </div>
      </ng-container>
    </div>
    <div *ngIf="group.value === 'raw' && event?.entries">
      <ng-container
        *ngFor="let entry of event?.entries"
        [ngSwitch]="entry.type"
      >
        <div *ngSwitchCase="'exception'">
          <p>{{ event?.title }}</p>
          <div *ngFor="let value of entry.data.values">
            <p
              class="spacer"
              *ngFor="let frame of value.stacktrace.frames.slice().reverse()"
            >
              at {{ frame.function }} ({{ frame.filename }}:{{
                frame.lineNo
              }}:{{ frame.colNo }})
            </p>
          </div>
        </div>
      </ng-container>
    </div>
  </section>
</section>
