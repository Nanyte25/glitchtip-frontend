<section *ngIf="issue$ | async as issue">
  <a
    mat-button
    [routerLink]="['/organizations', orgSlug$ | async, 'issues']"
    [queryParams]="{ project: issue.project.id }"
    >View all issues for {{ issue.project.name }}</a
  >
  <article class="header">
    <div>
      <h1 class="mat-headline">
        <ng-container [ngSwitch]="issue?.type">
          <ng-container *ngSwitchCase="'error'">
            <span class="mat-h1">
              <ng-container
                *ngIf="issue?.metadata.type; else errorTitleFunction"
              >
                {{ issue?.metadata.type }}
              </ng-container>
              <ng-template #errorTitleFunction>
                {{ issue?.metadata.function || "&lt;unknown&gt;" }}
              </ng-template></span
            ><span class="mat-h3">{{ issue?.culprit }}</span>
          </ng-container>
          <ng-container *ngSwitchCase="'csp'">
            <span class="mat-h1">{{ issue?.metadata.directive || "" }}</span>
            <span class="mat-h3">{{ issue?.metadata.uri }}</span>
          </ng-container>
          <ng-container *ngSwitchCase="'expectct' || 'expectstaple' || 'hpkp'">
            <span class="mat-h1">{{ issue?.metadata.message || "" }}</span>
            <span class="mat-h3">{{ issue?.metadata.origin }}</span>
          </ng-container>
          <ng-container *ngSwitchDefault>
            <span class="mat-h1">{{ issue?.metadata.title }}</span>
          </ng-container>
        </ng-container>
        <p class="mat-subheading-1">
          {{ issue?.metadata.value }}
        </p>
      </h1>
      <div class="button-row">
        <button
          *ngIf="issue?.status === 'unresolved'"
          mat-flat-button
          color="primary"
          (click)="markResolved()"
        >
          <mat-icon aria-hidden="true">done</mat-icon>
          Resolve
        </button>
        <button
          *ngIf="issue?.status === 'resolved'"
          mat-flat-button
          color="primary"
          (click)="markUnresolved()"
        >
          <mat-icon aria-hidden="true">done</mat-icon>
          Reopen
        </button>
        <button mat-flat-button (click)="markIgnored()">Ignore</button>
        <button mat-icon-button><mat-icon>delete</mat-icon></button>
      </div>
    </div>

    <table mat-table [dataSource]="[issue]">
      <ng-container matColumnDef="issueNum">
        <th mat-header-cell *matHeaderCellDef>Issue #</th>
        <td mat-cell *matCellDef="let element">{{ element.shortId }}</td>
      </ng-container>

      <ng-container matColumnDef="events">
        <th mat-header-cell *matHeaderCellDef>Events</th>
        <td mat-cell *matCellDef="let element">{{ element.count }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </article>
  <mat-divider></mat-divider>

  <div class="row">
    <div class="column left">
      <router-outlet></router-outlet>
    </div>

    <mat-list class="column right">
      <mat-list-item>
        <h4 mat-line>First Seen</h4>
        <dl mat-line>
          <dt class="mat-body-strong">When:</dt>
          <div></div>
          <dd *ngIf="issue && issue.lastSeen">
            {{ issue.firstSeen | daysAgo }} days ago
          </dd>
          <dd>
            {{ issue?.firstSeen | date: "long" }}
          </dd>
        </dl>
      </mat-list-item>
      <mat-list-item>
        <h4 mat-line>Last Seen</h4>
        <dl mat-line>
          <dt class="mat-body-strong">When:</dt>
          <dd *ngIf="issue && issue.lastSeen">
            {{ issue.lastSeen | daysAgo }} days ago
          </dd>
          <dd>
            {{ issue?.lastSeen | date: "long" }}
          </dd>
        </dl>
      </mat-list-item>
    </mat-list>
  </div>
</section>
