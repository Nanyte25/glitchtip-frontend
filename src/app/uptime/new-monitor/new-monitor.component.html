<section class="l-body">
    <header class="page-header">
      <h1 class="mat-display-1">Create a New Uptime Monitor</h1>
    </header>
    <mat-card>
      <mat-card-content>
        <mat-error *ngIf="error">{{ error }}</mat-error>
        <form [formGroup]="newMonitorForm" (ngSubmit)="onSubmit()">
            <div>
                <mat-form-field class="monitor-name">
                <input 
                    matInput
                    formControlName="name"
                    placeholder="Monitor Name"
                    required
                    [errorStateMatcher]="matcher"
                />
                <mat-error>
                    <span *ngIf="formName?.errors?.required">Enter a monitor name</span>
                </mat-error>
                </mat-form-field>
            </div>
            <div class="url-spacing">
                <mat-form-field>
                    <input
                    matInput
                    formControlName="url"
                    placeholder="Site URL"
                    required
                    [errorStateMatcher]="matcher"
                    />
                    <mat-error>
                        <span *ngIf="formUrl?.errors?.required">Enter a url</span>
                    </mat-error>
                    <mat-error>
                        <span *ngIf="formUrl?.errors?.pattern">Enter a valid url</span>
                    </mat-error>
                </mat-form-field>
            </div>
            <div class="associations">
                <div>
                    <mat-form-field>
                        <mat-label>Associated Project</mat-label>
                        <mat-select
                        formControlName="project"
                        > 
                        <ng-container *ngIf="orgProjects$ | async as orgProjects">
                            <mat-option value="" (onSelectionChange)="disableEnvironments()">None</mat-option>
                            <mat-option
                                *ngFor="let orgProject of orgProjects"
                                [value]="orgProject.id"
                                (onSelectionChange)="projectSelected(orgProject.slug)"
                            >
                                {{ orgProject.name }}
                            </mat-option>
                        </ng-container>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div>
                    <mat-form-field *ngIf="projectEnvironments$ | async as projectEnvironments">
                        <mat-label>Environment</mat-label>
                        <mat-select
                        formControlName="environment"
                        [disabled]="projectEnvironments.length < 1 || environmentsDisabled === false"
                        [value]="selectedEnvironment"
                        > 
                        <ng-container >
                            <mat-option value="">None</mat-option>
                            <mat-option
                                *ngFor="let projectEnvironment of projectEnvironments"
                                [value]="projectEnvironment.id"
                            >
                                {{ projectEnvironment.name }}
                            </mat-option>
                        </ng-container>
                        </mat-select>
                    </mat-form-field>
                </div>
            </div>
            <div class="advanced">
                <div>
                    <mat-form-field>
                        <mat-label>Monitor type</mat-label>
                        <mat-select
                        formControlName="monitorType"
                        required
                        [errorStateMatcher]="matcher"
                        >
                        <mat-option
                            *ngFor="let monitorType of monitorTypes"
                            [value]="monitorType"
                        >
                            {{ monitorType }}
                        </mat-option>
                        </mat-select>
                        <mat-error>
                            <span *ngIf="formMonitorType?.errors?.required">Choose a monitor type</span>
                        </mat-error>
                    </mat-form-field>
                </div>
                <div class="help-text">
                    <ng-container *ngIf="formMonitorType?.value === 'Ping'">
                        <p class="mat-caption">
                            GlitchTip will "ping" the specified URL using an 
                            HTTP HEAD request with no payload.
                        </p>
                    </ng-container>
                    <ng-container *ngIf="formMonitorType?.value === 'POST'">
                        <p class="mat-caption">
                            GlitchTip will send an HTTP GET request to the specified URL.
                            If the expected response is not received, the site will be marked as Down.
                        </p>
                    </ng-container>
                    <ng-container *ngIf="formMonitorType?.value === 'GET'">
                        <p class="mat-caption">
                            GlitchTip will send an HTTP POST request to the specified URL.
                            If the expected response is not received, the site will be marked as Down.
                        </p>
                    </ng-container>
                    <ng-container *ngIf="formMonitorType?.value === 'Heartbeat'">
                        <p class="mat-caption">
                            GlitchTip will await requests from your site 
                            to ensure it is active. If it doesn't receive 
                            the request, the site will be marked as Down.
                        </p>
                    </ng-container>
                </div>
            </div>
            <div class="advanced">
                <div>
                    <mat-form-field>
                        <mat-label>Expected Status</mat-label>
                        <input
                        matInput
                        min="0"
                        max="1000"
                        type="number"
                        default="200"
                        autocomplete="off"
                        formControlName="expectedStatus"
                        placeholder="Status code"
                        required 
                        [errorStateMatcher]="matcher"
                        />
                        <mat-error *ngIf="formExpectedStatus?.errors">
                        <span *ngIf="formExpectedStatus?.errors?.min"
                            >The quantity needs to be greater than or equal to 100.</span
                        >
                        <span *ngIf=
                            "formExpectedStatus?.errors?.invalidNumber
                            || formExpectedStatus?.errors?.required
                            "
                            >Enter a status code number.
                        </span>
                        </mat-error>
                    </mat-form-field>
                </div>    
                <div>
                    <mat-form-field>
                        <mat-label>Interval (seconds)</mat-label>
                        <input
                        matInput
                        min="0"
                        type="number"
                        default="60"
                        autocomplete="off"
                        formControlName="interval"
                        placeholder="60"
                        required
                        [errorStateMatcher]="matcher"
                        />
                        <mat-error *ngIf="formInterval?.errors">
                            <span *ngIf="formInterval?.errors?.min"
                                >The number needs to be greater than or equal to 1.</span
                            >
                            <span *ngIf=
                                "formInterval?.errors?.invalidNumber
                                || formInterval?.errors?.required
                                "
                                >Enter a number.
                            </span>
                            </mat-error>
                    </mat-form-field>
                </div>
            </div>
          <gt-loading-button
            class="submit"
            id="create-project-submit"
            [loading]="loading === true"
            buttonText="Create Monitor"
          >
          </gt-loading-button>
        </form> </mat-card-content
    ></mat-card>
  </section>